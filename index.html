<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>岁时记 - 倒计时</title>
    <!-- 引入 Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 引入 React, ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- 引入 Babel 转换器 -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        /* 引入宋体风格字体 (可选，增强中式美感) */
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;700;900&display=swap');
        
        .font-serif {
            font-family: 'Noto Serif SC', serif;
        }
        
        /* 自定义 keyframes */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-\[fadeIn\_0\.3s\_ease-out\] {
            animation: fadeIn 0.3s ease-out;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // 确保从全局 window 对象中获取 React 和 ReactDOM 模块
        const { useState, useEffect } = window.React;
        const { createRoot } = window.ReactDOM;
        
        // --- 图标组件 (替换 Lucide Icons) ---
        // 使用内联 SVG 确保单文件稳定性
        const Icon = ({ path, size = 24, className = "" }) => (
            <svg 
                xmlns="http://www.w3.org/2000/svg" 
                width={size} 
                height={size} 
                viewBox="0 0 24 24" 
                fill="none" 
                stroke="currentColor" 
                strokeWidth="2" 
                strokeLinecap="round" 
                strokeLinejoin="round" 
                className={className}
            >
                {path}
            </svg>
        );

        const Plus = (props) => <Icon {...props} path={<path d="M12 5v14M5 12h14"/>} />;
        const X = (props) => <Icon {...props} path={<path d="M18 6l-12 12M6 6l12 12"/>} />;
        const Trash2 = (props) => <Icon {...props} path={<path d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6M10 11v6M14 11v6M17 6H7"/>} />;
        const Sparkles = (props) => <Icon {...props} path={<path d="M10 6L9 2 8 6M2 12l4 1 1-4 1 4 4 1-4 1-1 4-1-4-4-1zM18 18l-1 4-1-4-4-1 4-1 1-4 1 4 4 1z"/>} />;
        const Flower2 = (props) => <Icon {...props} path={<path d="M12 2a3 3 0 0 0-3 3c0 3 3 6 3 6s3-3 3-6a3 3 0 0 0-3-3zM18 13.5a3 3 0 0 0-3 3c0 3 3 6 3 6s3-3 3-6a3 3 0 0 0-3-3zM6 13.5a3 3 0 0 0-3 3c0 3 3 6 3 6s3-3 3-6a3 3 0 0 0-3-3zM12 12v10"/>} />;
        // 修复：将 <circle> 和 <path> 元素包裹在一个 React Fragment (<> </>) 中
        const Sun = (props) => <Icon {...props} path={<><circle cx="12" cy="12" r="4"/><path d="M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M4.93 17.07l1.41-1.41M17.66 6.34l1.41-1.41"/></>} />;
        const Moon = (props) => <Icon {...props} path={<path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/>} />;
        const Wind = (props) => <Icon {...props} path={<path d="M17 6H3M21 12H8M26 18H13"/>} />;
        const Cloud = (props) => <Icon {...props} path={<path d="M17.5 19H9a4 4 0 1 1 0-8h11a4 4 0 0 1-1.47 7.5l-.03.5Zm-1.8-6.5a2 2 0 1 0 0-4"/>} />;

        // --- 颜色配置：中国传统色 ---
        const COLORS = {
            vermilion: 'from-red-500 to-orange-600', // 朱砂 (春节)
            indigo: 'from-blue-600 to-slate-700',     // 靛蓝 (商务/现代)
            jade: 'from-emerald-500 to-teal-600',     // 翡翠 (清明/端午)
            gold: 'from-amber-400 to-orange-500',     // 琥珀 (中秋/丰收)
            purple: 'from-purple-500 to-pink-600',    // 紫气 (七夕/浪漫)
        };

        // --- 辅助函数：计算剩余时间 ---
        const calculateTimeLeft = (targetDate) => {
            const difference = +new Date(targetDate) - +new Date();
            
            if (difference <= 0) {
                return { days: 0, hours: 0, minutes: 0, seconds: 0, finished: true };
            }

            return {
                days: Math.floor(difference / (1000 * 60 * 60 * 24)),
                hours: Math.floor((difference / (1000 * 60 * 60)) % 24),
                minutes: Math.floor((difference / 1000 / 60) % 60),
                seconds: Math.floor((difference / 1000) % 60),
                finished: false
            };
        };

        // --- 组件：背景纹理 ---
        const BackgroundTexture = () => (
            <div className="fixed inset-0 z-0 pointer-events-none bg-[#fdfbf7]">
                {/* 模拟宣纸纹理 */}
                <div className="absolute inset-0 opacity-[0.4]" style={{ backgroundImage: `url("data:image/svg+xml,%3Csvg width='200' height='200' viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.15'/%3E%3C/svg%3E")` }}></div>
                
                {/* 柔和的光晕 */}
                <div className="absolute -top-[10%] -right-[10%] w-[600px] h-[600px] bg-orange-100/50 rounded-full blur-[100px]" />
                <div className="absolute top-[40%] -left-[10%] w-[500px] h-[500px] bg-red-50/50 rounded-full blur-[80px]" />
                <div className="absolute bottom-0 right-0 w-[400px] h-[400px] bg-emerald-50/50 rounded-full blur-[100px]" />
            </div>
        );

        // --- 组件：头部大卡片 (最近的重要节日) ---
        const HeroCard = ({ event }) => {
            const [timeLeft, setTimeLeft] = useState(calculateTimeLeft(event.date));

            useEffect(() => {
                const timer = setInterval(() => {
                    setTimeLeft(calculateTimeLeft(event.date));
                }, 1000);
                return () => clearInterval(timer);
            }, [event.date]);

            return (
                <div className="relative w-full overflow-hidden rounded-[2rem] bg-gradient-to-br from-red-600 to-orange-700 shadow-2xl shadow-red-900/20 text-white mb-10 group">
                    {/* 装饰纹样 */}
                    <div className="absolute top-0 right-0 p-10 opacity-10 scale-150 transform group-hover:rotate-12 transition-transform duration-700">
                        {/* 使用内联 SVG 组件 */}
                        <Flower2 size={200} />
                    </div>

                    <div className="relative z-10 p-8 md:p-12 flex flex-col md:flex-row justify-between items-center gap-8">
                        <div className="text-center md:text-left">
                            <div className="inline-flex items-center gap-2 bg-white/10 backdrop-blur-md px-4 py-1.5 rounded-full border border-white/20 mb-4">
                                <Sparkles size={14} className="text-yellow-200" />
                                <span className="text-xs font-medium tracking-widest uppercase text-yellow-100">即将到来</span>
                            </div>
                            <h2 className="text-4xl md:text-6xl font-bold tracking-tight font-serif mb-2">{event.title}</h2>
                            <p className="text-red-100 text-lg font-light tracking-wide opacity-80">{new Date(event.date).toLocaleDateString('zh-CN', { year: 'numeric', month: 'long', day: 'numeric' })}</p>
                        </div>

                        <div className="flex gap-4 md:gap-8 text-center">
                           {[
                             { val: timeLeft.days, label: '天' },
                             { val: timeLeft.hours, label: '时' },
                             { val: timeLeft.minutes, label: '分' },
                           ].map((item, idx) => (
                             <div key={idx} className="flex flex-col items-center">
                               <span className="text-5xl md:text-7xl font-light font-mono tabular-nums tracking-tighter">
                                 {String(item.val).padStart(2, '0')}
                               </span>
                               <span className="text-sm text-red-200 mt-2 font-medium">{item.label}</span>
                             </div>
                           ))}
                           <div className="flex flex-col items-center justify-end pb-2">
                              <span className="text-2xl text-red-300 font-light mb-8 animate-pulse">:</span>
                           </div>
                           <div className="flex flex-col items-center">
                               <span className="text-5xl md:text-7xl font-light font-mono tabular-nums tracking-tighter text-yellow-200">
                                 {String(timeLeft.seconds).padStart(2, '0')}
                               </span>
                               <span className="text-sm text-yellow-200/80 mt-2 font-medium">秒</span>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // --- 组件：普通卡片 ---
        const EventCard = ({ event, onDelete }) => {
            const [timeLeft, setTimeLeft] = useState(calculateTimeLeft(event.date));

            useEffect(() => {
                const timer = setInterval(() => {
                    setTimeLeft(calculateTimeLeft(event.date));
                }, 1000);
                return () => clearInterval(timer);
            }, [event.date]);

            // 获取主题色
            const themeGradient = COLORS[event.colorType] || COLORS.indigo;

            return (
                <div className="group relative bg-white/60 backdrop-blur-md rounded-[1.5rem] border border-stone-200/50 p-6 hover:shadow-xl hover:shadow-stone-200/50 transition-all duration-300 hover:-translate-y-1">
                    <div className="flex justify-between items-start mb-6">
                        <div className={`p-3 rounded-2xl bg-gradient-to-br ${themeGradient} text-white shadow-lg`}>
                            {event.icon}
                        </div>
                        <button 
                            onClick={() => onDelete(event.id)}
                            className="text-stone-300 hover:text-red-400 transition-colors"
                        >
                            <Trash2 size={18} />
                        </button>
                    </div>

                    <div className="mb-4">
                        <h3 className="text-xl font-bold text-stone-800 mb-1 font-serif">{event.title}</h3>
                        <p className="text-xs text-stone-500 font-medium tracking-wide">
                            {new Date(event.date).toLocaleDateString('zh-CN', { weekday: 'long', month: 'short', day: 'numeric' })}
                        </p>
                    </div>

                    <div className="flex items-baseline gap-1">
                        <span className={`text-4xl font-semibold bg-clip-text text-transparent bg-gradient-to-br ${themeGradient} tabular-nums`}>
                            {timeLeft.days}
                        </span>
                        <span className="text-sm text-stone-400 font-medium mr-4">天</span>
                        
                        {timeLeft.days < 100 && (
                            <>
                                <span className="text-2xl text-stone-600 font-light tabular-nums">{String(timeLeft.hours).padStart(2,'0')}</span>
                                <span className="text-xs text-stone-400 mr-1">时</span>
                                <span className="text-2xl text-stone-600 font-light tabular-nums">{String(timeLeft.minutes).padStart(2,'0')}</span>
                                <span className="text-xs text-stone-400">分</span>
                            </>
                        )}
                    </div>

                    {/* 进度条装饰 (这里的 60% 是占位符，实际应用中应根据时间计算) */}
                    <div className="absolute bottom-0 left-6 right-6 h-1 bg-stone-100 rounded-full overflow-hidden mb-6">
                        <div className={`h-full bg-gradient-to-r ${themeGradient} opacity-30`} style={{ width: '60%' }}></div>
                    </div>
                </div>
            );
        };

        // --- 组件：添加模态框 ---
        const AddModal = ({ isOpen, onClose, onAdd }) => {
            const [title, setTitle] = useState('');
            const [date, setDate] = useState('');
            const [colorType, setColorType] = useState('indigo');

            if (!isOpen) return null;

            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center p-6">
                    <div className="absolute inset-0 bg-stone-900/20 backdrop-blur-sm transition-opacity" onClick={onClose} />
                    <div className="relative w-full max-w-md bg-white rounded-[2rem] shadow-2xl p-8 animate-[fadeIn_0.3s_ease-out]">
                        <div className="flex justify-between items-center mb-8">
                            <h2 className="text-2xl font-serif font-bold text-stone-800">新添 · 拾光</h2>
                            <button onClick={onClose} className="p-2 bg-stone-100 rounded-full hover:bg-stone-200 transition">
                                <X size={20} className="text-stone-600" />
                            </button>
                        </div>

                        <div className="space-y-6">
                            <div>
                                <label className="block text-xs font-bold text-stone-400 uppercase tracking-wider mb-2">事件名称</label>
                                <input 
                                    className="w-full bg-stone-50 border border-stone-200 rounded-xl px-4 py-3 text-stone-800 focus:outline-none focus:ring-2 focus:ring-stone-400 transition"
                                    placeholder="例如：奶奶的生日"
                                    value={title}
                                    onChange={e => setTitle(e.target.value)}
                                />
                            </div>

                            <div>
                                <label className="block text-xs font-bold text-stone-400 uppercase tracking-wider mb-2">目标日期</label>
                                <input 
                                    type="datetime-local"
                                    className="w-full bg-stone-50 border border-stone-200 rounded-xl px-4 py-3 text-stone-800 focus:outline-none focus:ring-2 focus:ring-stone-400 transition"
                                    value={date}
                                    onChange={e => setDate(e.target.value)}
                                />
                            </div>

                            <div>
                                <label className="block text-xs font-bold text-stone-400 uppercase tracking-wider mb-2">色彩意象</label>
                                <div className="flex gap-3">
                                    {[
                                        { id: 'vermilion', color: 'bg-red-500', name: '朱砂' },
                                        { id: 'jade', color: 'bg-emerald-500', name: '翡翠' },
                                        { id: 'indigo', color: 'bg-blue-600', name: '靛蓝' },
                                        { id: 'gold', color: 'bg-amber-400', name: '琥珀' },
                                        { id: 'purple', color: 'bg-purple-500', name: '紫气' },
                                    ].map(c => (
                                        <button
                                            key={c.id}
                                            type="button" // 防止在表单内自动提交
                                            onClick={() => setColorType(c.id)}
                                            className={`flex-1 py-2 rounded-xl border flex flex-col items-center justify-center gap-1 transition-all ${colorType === c.id ? 'border-stone-800 bg-stone-50' : 'border-transparent hover:bg-stone-50'}`}
                                        >
                                            <div className={`w-4 h-4 rounded-full ${c.color}`} />
                                            <span className="text-[10px] text-stone-500">{c.name}</span>
                                        </button>
                                    ))}
                                </div>
                            </div>

                            <button 
                                type="button" // 使用 type="button" 避免模态框内自动刷新
                                onClick={() => {
                                    if(!title || !date) return;
                                    onAdd({ title, date, colorType });
                                }}
                                className="w-full bg-stone-800 text-white py-4 rounded-xl font-bold mt-4 hover:bg-stone-900 transition-colors shadow-lg shadow-stone-300"
                            >
                                开始倒数
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        // --- 主程序 ---
        function App() {
            const [events, setEvents] = useState([
                { 
                    id: 1, 
                    title: '二零二六 · 元旦', 
                    date: '2026-01-01T00:00:00', 
                    colorType: 'indigo',
                    icon: <Sun size={24} /> 
                },
                { 
                    id: 2, 
                    title: '丙午马年 · 春节', 
                    date: '2026-02-17T00:00:00', // 2026 春节
                    colorType: 'vermilion',
                    icon: <Flower2 size={24} />
                },
                { 
                    id: 3, 
                    title: '清明', 
                    date: '2026-04-05T00:00:00', 
                    colorType: 'jade',
                    icon: <Wind size={24} />
                },
                { 
                    id: 4, 
                    title: '劳动节假期', 
                    date: '2026-05-01T00:00:00', 
                    colorType: 'purple',
                    icon: <Cloud size={24} />
                },
                { 
                    id: 5, 
                    title: '端午节', 
                    date: '2026-06-19T00:00:00', // 2026 端午 (Approx)
                    colorType: 'jade',
                    icon: <Wind size={24} />
                },
                { 
                    id: 6, 
                    title: '中秋佳节', 
                    date: '2026-09-25T00:00:00', // 2026 中秋
                    colorType: 'gold',
                    icon: <Moon size={24} />
                },
            ]);

            const [isModalOpen, setIsModalOpen] = useState(false);

            // 找出最近的一个重要节日作为 Hero Card
            const upcomingEvents = events
                .filter(e => new Date(e.date) > new Date())
                .sort((a, b) => new Date(a.date) - new Date(b.date));
            
            const heroEvent = upcomingEvents[0];
            const otherEvents = upcomingEvents.slice(1);

            const addEvent = ({ title, date, colorType }) => {
                const newEvent = {
                    id: Date.now(),
                    title,
                    date,
                    colorType,
                    icon: <Sparkles size={24} /> // 默认图标
                };
                setEvents([...events, newEvent]);
                setIsModalOpen(false);
            };

            const deleteEvent = (id) => {
                setEvents(events.filter(e => e.id !== id));
            };

            return (
                <div className="min-h-screen text-stone-800 font-sans relative selection:bg-red-100 selection:text-red-900">
                    <BackgroundTexture />

                    {/* 顶部导航 */}
                    <nav className="relative z-10 px-6 py-6 flex justify-between items-center max-w-6xl mx-auto">
                        <div className="flex items-center gap-3">
                            <div className="w-10 h-10 bg-stone-900 text-white flex items-center justify-center rounded-xl font-serif text-xl font-bold">
                                岁
                            </div>
                            <div className="flex flex-col">
                                <h1 className="text-xl font-bold font-serif tracking-tight text-stone-900">岁时记</h1>
                                <span className="text-[10px] text-stone-400 uppercase tracking-widest">Time & Tide</span>
                            </div>
                        </div>
                        
                        <button 
                            onClick={() => setIsModalOpen(true)}
                            className="group flex items-center gap-2 px-5 py-2.5 bg-white border border-stone-200 rounded-full hover:bg-stone-50 hover:shadow-md transition-all duration-300"
                        >
                            <Plus size={16} className="text-stone-600 group-hover:rotate-90 transition-transform duration-300" />
                            <span className="text-sm font-medium text-stone-600">添加</span>
                        </button>
                    </nav>

                    {/* 主要内容 */}
                    <main className="relative z-10 px-6 pb-20 max-w-6xl mx-auto pt-8">
                        
                        {/* 诗句 Header */}
                        <div className="mb-10 text-center">
                            <p className="text-stone-400 font-serif italic text-lg mb-2">"逝者如斯夫，不舍昼夜。"</p>
                            <div className="w-12 h-1 bg-gradient-to-r from-red-500 to-orange-500 mx-auto rounded-full opacity-60"></div>
                        </div>

                        {/* 核心大图 (Hero) */}
                        {heroEvent ? (
                            <HeroCard event={heroEvent} />
                        ) : (
                            <div className="w-full h-64 flex items-center justify-center bg-stone-100 rounded-[2rem] mb-10 border-2 border-dashed border-stone-300">
                                <p className="text-stone-400 font-medium">暂无即将到来的日程</p>
                            </div>
                        )}

                        {/* 列表标题 */}
                        <div className="flex items-center gap-4 mb-6">
                            <h3 className="text-xl font-serif font-bold text-stone-800">未来光阴</h3>
                            <div className="h-px flex-1 bg-stone-200"></div>
                            <span className="text-xs text-stone-400 font-medium">{otherEvents.length} 个记录</span>
                        </div>

                        {/* 卡片网格 */}
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            {otherEvents.map(event => (
                                <EventCard key={event.id} event={event} onDelete={deleteEvent} />
                            ))}
                            
                            {/* 快捷添加卡片 */}
                            <button 
                                onClick={() => setIsModalOpen(true)}
                                className="group min-h-[180px] rounded-[1.5rem] border-2 border-dashed border-stone-300 hover:border-stone-400 hover:bg-stone-50/50 transition-all flex flex-col items-center justify-center gap-3"
                            >
                                <div className="w-12 h-12 rounded-full bg-stone-100 flex items-center justify-center group-hover:scale-110 transition-transform">
                                    <Plus size={24} className="text-stone-400" />
                                </div>
                                <span className="text-stone-400 text-sm font-medium group-hover:text-stone-600">记录新时刻</span>
                            </button>
                        </div>

                    </main>

                    <AddModal isOpen={isModalOpen} onClose={() => setIsModalOpen(false)} onAdd={addEvent} />

                    <footer className="relative z-10 text-center py-8 text-stone-400 text-xs">
                        <p>岁岁年年 · 共此此时</p>
                    </footer>
                </div>
            );
        }

        // 渲染组件到 DOM
        createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>
